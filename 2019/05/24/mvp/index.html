<!DOCTYPE html>
<html lang=>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  
    <link rel="icon" href="https://upload.jianshu.io/users/upload_avatars/15366117/419c97cc-d9aa-486b-9ded-3c06463a992e.jpg?imageMogr2/auto-orient/strip|imageView2/1/w/240/h/240">
  
    
  <title>MVPæ¨¡å¼å®æˆ˜(éŸ³ä¹APP-Android-Kotlin) | Override0330</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/lib/jquery.fancybox.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <header>
  <div class="header-container">
    <a class="logo" href="/">
      <span>Override0330</span>
    </a>
    <ul class="right-header">
      
        <li class="nav-item">
          
            <a href="/" class="item-link">é¦–é¡µ</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/about" class="item-link">å…³äº</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/archives" class="item-link">å½’æ¡£</a>
          
        </li>
      
        <li class="nav-item">
          
            <a href="/tags" class="item-link">æ ‡ç­¾</a>
          
        </li>
      
    </ul>
  </div>
</header>

  <main id="post">
  <div class="content">
    <article>
        <section class="content markdown-body">
          <h1>MVPæ¨¡å¼å®æˆ˜(éŸ³ä¹APP-Android-Kotlin)</h1>
          <div class="post-meta">
            <i class="fa fa-calendar" aria-hidden="true"></i> <time>2019/05/24</time>
            
            
          </div>
          <p>è¡¥ä¸€è¡¥å‰é¢å·æ‡’çš„åšå®¢(1/4)<br>åªæ˜¯ä¸ªäººæ€»ç»“çš„æ–‡ç« ä¸å°å¿ƒè¢«ä½ æ‰¾åˆ°å•¦~<br>å¦‚æœæ„Ÿå…´è¶£çš„è¯é¡¹ç›®åœ°å€åœ¨æ–‡æœ«</p>
<h2 id="1-What-is-thatï¼Ÿ"><a href="#1-What-is-thatï¼Ÿ" class="headerlink" title="1. What is thatï¼Ÿ"></a>1. What is thatï¼Ÿ</h2><p>MVPæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼(æ¡†æ¶)ï¼Œå› ä¸ºå…¶å‡ºè‰²çš„è§£è€¦åŠŸèƒ½å¹¿æ³›åœ°ç”¨äºAndroidå·¥ç¨‹ä¸­ï¼Œå®ƒå°†åº”ç”¨ç¨‹åºåˆ†ä¸ºModel-View-Presenterï¼Œå„å¸å…¶èŒï¼Œç®€ç§°MVP</p>
<ul>
<li><strong>Model(æ¨¡å‹)</strong> è´Ÿè´£å¯¹æ•°æ®çš„å¤„ç†å’Œå­˜å‚¨ï¼Œå°†æ•°æ®å›è°ƒç»™Presenter</li>
<li><strong>Presenter(ä¸»æŒè€…)</strong> è´Ÿè´£å°†Viewå±‚çš„è¯·æ±‚(å¦‚ç‚¹å‡»ï¼Œæ›´æ–°è§†å›¾æ•°æ®)è¿›è¡Œè½¬å‘ç»™å¯¹åº”çš„Modelï¼Œæ¥å—å›è°ƒåå†é€šçŸ¥Viewå±‚æ›´æ–°è§†å›¾</li>
<li><strong>View(è§†å›¾)</strong> ä»…è´Ÿè´£å°†æ˜¾ç¤ºæ•°æ®  </li>
<li><strong>Contract(å¥‘çº¦ç±»)</strong> ä»…ä»…ç”¨äºå®šä¹‰Viewå’ŒModelçš„æ¥å£ï¼Œä¾¿äºç®¡ç†å’ŒæŸ¥çœ‹</li>
</ul>
<p><strong>ä¸€æ¬¡ç®€å•çš„æ›´æ–°è§†å›¾çš„åŸºæœ¬æµç¨‹</strong><br><img src="https://user-gold-cdn.xitu.io/2019/5/24/16ae755c1d77d3ac?w=2048&amp;h=1271&amp;f=png&amp;s=636254" alt="ä¸€æ¬¡ç®€å•çš„æ›´æ–°è§†å›¾çš„åŸºæœ¬æµç¨‹"><br>é¡ºåºå°±æ˜¯æŒ‰ç…§â‘ â‘¡â‘¢â‘£â‘¤æ¥è¿›è¡Œ<br>1ï¸âƒ£åœ¨Viewä¸­ï¼Œæˆ‘ä»¬å‘Presenterå‘é€ä¸€æ¬¡æ›´æ–°TextViewçš„è¯·æ±‚<br>2ï¸âƒ£Presenteræ”¶åˆ°è¯·æ±‚åå†å‘å¯¹åº”çš„Modelå‘é€è·å–Stringçš„è¯·æ±‚(ä¸­é—´å¯èƒ½æœ‰è€—æ—¶æ“ä½œï¼Œæ‰€ä»¥å¯èƒ½éœ€è¦å›è°ƒæ¥å£)<br>3ï¸âƒ£æˆåŠŸæ‹¿åˆ°æ•°æ®åå†é€šè¿‡å›è°ƒæ¥å£ç»™Presenter<br>4ï¸âƒ£Presenteræ‹¿åˆ°æ•°æ®åå†è§¦å‘Viewçš„å›è°ƒ<br>5ï¸âƒ£æœ€åå®ŒæˆViewçš„è§†å›¾æ›´æ–°ã€‚<br>è‡ªå§‹è‡³ç»ˆï¼ŒViewåšçš„äº‹æƒ…åªæœ‰å¤„ç†ç”¨æˆ·çš„è¯·æ±‚(æ›´æ–°TextView)å¹¶å‘é€ç»™Presenterï¼Œç„¶åæä¾›ä¸€ä¸ªç”¨æ¥æ›´æ–°è§†å›¾çš„å›è°ƒ;Presenteråšçš„äº‹æƒ…åªæœ‰è½¬å‘ï¼Œè‡ªå·±æœ¬èº«ä¸å¤„ç†é€»è¾‘;modelè´Ÿè´£æä¾›ä¿¡æ¯ï¼ŒåŒæ—¶åŒ…æ‹¬æ•°æ®çš„å¤„ç†ã€‚</p>
<blockquote>
<p>æœ‰çš„ç‰ˆæœ¬çš„MVPå¯èƒ½é€‰æ‹©å°†æ•°æ®å¤„ç†æ”¾å…¥Presenterä¸­ï¼Œç„¶åmodelåªæœ‰ä¸€ä¸ªsetter/getterçš„ç±»ä¼¼JavaBeançš„ä½œç”¨ï¼Œä½†æ˜¯æˆ‘è§‰å¾—è¿™æ ·å¤„ç†ä½¿å¾—Presenterå˜å¾—å¾ˆè‡ƒè‚¿ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©å°†é€»è¾‘å¤„ç†æ”¾å…¥Modelã€‚ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥âˆš</p>
</blockquote>
<h2 id="2-MVPé€šç”¨æ¡†æ¶"><a href="#2-MVPé€šç”¨æ¡†æ¶" class="headerlink" title="2. MVPé€šç”¨æ¡†æ¶"></a>2. MVPé€šç”¨æ¡†æ¶</h2><h3 id="2-1-Contractå±‚"><a href="#2-1-Contractå±‚" class="headerlink" title="2.1 Contractå±‚"></a>2.1 Contractå±‚</h3><p>Contractå¹¶æ²¡æœ‰ä»€ä¹ˆå¾ˆé€šç”¨ä¸ªæ¡†æ¶ï¼Œå› ä¸ºæ¯ä¸ªè§†å›¾å’Œæ¯ä¸€ä¸ªmodelçš„å·¥ä½œå„ä¸ç›¸åŒï¼Œè¿™é‡Œç»™å‡ºçš„æ˜¯ä¸Šå›¾ä¸­çš„çš„èŒƒä¾‹<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailContract</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">DetailView</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">onChangeText</span><span class="params">(String)</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">DetailModel</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getNowText</span><span class="params">(callBack: <span class="type">GetTextCallBack</span>)</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">GetTextCallBack</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">onSuccess</span><span class="params">(str:<span class="type">String</span>)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">onFail</span><span class="params">(info:<span class="type">String</span>)</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-2-Modelå±‚"><a href="#2-2-Modelå±‚" class="headerlink" title="2.2 Modelå±‚"></a>2.2 Modelå±‚</h3><p>Modelä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¾ˆé€šç”¨çš„æ¡†æ¶ï¼Œè¿™é‡Œç»™å‡ºçš„æ˜¯ä¸Šå›¾ä¸­çš„èŒƒä¾‹<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleModel</span>: <span class="type">DetailContract.DetailModel&#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> getNowText(callBack: GetTextCallBack)&#123;</span><br><span class="line">        <span class="keyword">val</span> str = ...</span><br><span class="line">        <span class="comment">//ä»¥ä¸Šæ˜¯è·å–Stringçš„æ“ä½œ</span></span><br><span class="line">        <span class="keyword">if</span>(str!=<span class="string">""</span>)&#123;</span><br><span class="line">            callBack.onSuccess(str)   </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            callBake.onFail(<span class="string">"è·å–å¤±è´¥"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„å…·ä½“Modelç±»å®ç°äº†Contractå¥‘çº¦ç±»ä¸­çš„æ¥å£ï¼Œæ–¹ä¾¿æˆ‘ä»¬Presenterè¿›è¡Œè°ƒç”¨</p>
<h3 id="2-3-Viewå±‚"><a href="#2-3-Viewå±‚" class="headerlink" title="2.3 Viewå±‚"></a>2.3 Viewå±‚</h3><p>Viewåœ¨Androidä¸­ä¸€èˆ¬åŒ…æ‹¬ä¸¤ç§ï¼Œä¸€ç§æ˜¯Activityï¼Œä¸€ç§æ˜¯Fragmentï¼Œè¿™é‡Œåªç»™å‡ºActivityçš„å°è£…ï¼ŒFragmentç±»ä¼¼ï¼Œéœ€è¦å¤„ç†ä¸€äº›ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ã€‚</p>
<p><strong>Activity:</strong><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span>&lt;<span class="type">V,T:BasePresenter&lt;V</span>&gt;&gt;:<span class="type">Activity</span></span>()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> TAG:String = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mPresenter: T</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> mContext: Context</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        mContext = <span class="keyword">this</span></span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–Presenter</span></span><br><span class="line">        mPresenter = createPresenter()</span><br><span class="line">        <span class="comment">//å°†Presenterå’ŒViewç»‘å®š</span></span><br><span class="line">        mPresenter.attachView(<span class="keyword">this</span> <span class="keyword">as</span> V)</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–å¸ƒå±€</span></span><br><span class="line">        initView(savedInstanceState)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åº”è¯¥ç”±å­ç±»è¿›è¡Œå®ç°çš„åˆå§‹åŒ–viewçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºå¯¹åº”çš„Presenter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">createPresenter</span><span class="params">()</span></span>:T</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è§£é™¤ç»‘å®š</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        mPresenter.detachView()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>BaseActivityæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€æœ‰åŠ å…¥MVPæ¨¡å¼çš„Activityéƒ½åº”è¯¥ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ã€‚<br>æ³›å‹Vä»£è¡¨çš„æ˜¯è§†å›¾(å³è‡ªå·±)ï¼ŒTåˆ™æ˜¯å¯¹åº”çš„Presenterã€‚Viewå±‚æŒæœ‰å¯¹åº”Presenterçš„å¼•ç”¨ï¼Œç”¨æ¥å‘é€æ¶ˆæ¯ã€‚</p>
<h3 id="2-4-Presenterå±‚"><a href="#2-4-Presenterå±‚" class="headerlink" title="2.4 Presenterå±‚"></a>2.4 Presenterå±‚</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePresenter</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//Viewæ¥å£ç±»å‹çš„å¼±å¼•ç”¨,é˜²æ­¢æ‰€æŒæœ‰çš„viewå·²ç»è¢«é”€æ¯ï¼Œä½†æ˜¯è¯¥presenterä»ç„¶æŒæœ‰ï¼Œå¯¼è‡´å†…å­˜çš„æ³„éœ²</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> mViewRef:Reference&lt;T&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»‘å®šViewå¼•ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">attachView</span><span class="params">(view:<span class="type">T</span>)</span></span>&#123;</span><br><span class="line">        mViewRef = SoftReference&lt;T&gt;(view)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–å½“å‰ç»‘å®šçš„Viewå¼•ç”¨</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">getView</span><span class="params">()</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> mViewRef.<span class="keyword">get</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ˜¯å¦å·²ç»‘å®šView</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">isViewAttached</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> mViewRef != <span class="literal">null</span>&amp;&amp;mViewRef.<span class="keyword">get</span>()!=<span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è§£é™¤å¼•ç”¨</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">detachView</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mViewRef != <span class="literal">null</span>)&#123;</span><br><span class="line">            mViewRef.clear()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BasePresenteræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€æœ‰åŠ å…¥MVPæ¨¡å¼çš„Presenteréƒ½åº”è¯¥ç»§æ‰¿è¯¥æŠ½è±¡ç±»ã€‚<br>PresenteræŒæœ‰Viewå±‚çš„ä¸€ä¸ªå¼±å¼•ç”¨ï¼ŒåŒæ—¶åŒ…æ‹¬4ä¸ªå’Œå¼±å¼•ç”¨æœ‰å…³çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ç»‘å®šViewçš„å¼•ç”¨ï¼Œè·å–å½“å‰Viewçš„å¼•ç”¨ï¼Œåˆ¤å®šæ˜¯å¦å·²ç»‘å®šäº†Viewï¼Œè§£é™¤Viewçš„å¼•ç”¨ã€‚<br>åœ¨å…·ä½“çš„Presenterä¸­è¿˜æ‹¥æœ‰ä¸€ä¸ªå¯¹åº”Modelå¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯PresenteråŒæ—¶æŒæœ‰Viewå’ŒModelï¼Œè¿™æ ·æ‰å¯ä»¥åšåˆ°ä¿¡æ¯çš„è½¬å‘åŠŸèƒ½</p>
<blockquote>
<p>ä¼ å…¥çš„æ˜¯Contractä¸­çš„Viewæ¥å£ç±»å‹æ˜¯å› ä¸ºå¯ä»¥ä½¿å¾—Presenteråªé€šè¿‡æ¥å£å‘viewä¼ è¾“ä¼ è¾“ä¿¡æ¯ã€‚è€Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ã€‚</p>
</blockquote>
<p>ä»¥ä¸Šå°±æ˜¯ä¸€äº›å¸¸ç”¨çš„æ¡†æ¶ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨å®æˆ˜æ¥ç»§ç»­åŠ æ·±ç†è§£ï¼š</p>
<h2 id="3-å®æˆ˜"><a href="#3-å®æˆ˜" class="headerlink" title="3. å®æˆ˜"></a>3. å®æˆ˜</h2><p>è¯¥èŒƒä¾‹é€‰è‡ªçº¢å²©ç§»åŠ¨å¼€å‘éƒ¨çš„ä¸­æœŸè€ƒæ ¸ï¼Œå†…å®¹ä¸ºä¸€ä¸ªéŸ³ä¹Appã€‚ä»…ä»…åˆ†ææ’­æ”¾é¡µé¢(<del>å› ä¸ºæˆ‘å°±åšäº†ä¸¤ä¸ªé¡µé¢ğŸ˜­</del>)<br>|ä¸»é¡µ|æ’­æ”¾é¡µ|<br>|â€”â€”|â€”â€”|<br>|<img src="https://user-gold-cdn.xitu.io/2019/5/24/16ae7d280dd40c19?w=560&amp;h=864&amp;f=png&amp;s=142300" alt="">|<img src="https://user-gold-cdn.xitu.io/2019/5/24/16ae7d2cba23d1df?w=564&amp;h=866&amp;f=png&amp;s=154537" alt="">|<br>ä¸»è¦åŠŸèƒ½å°±æ˜¯æ’­æ”¾æ’­æ”¾éŸ³ä¹ä»¥åŠæ­Œè¯çš„æ»šåŠ¨<br>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç»“æ„ï¼š<br><img src="https://user-gold-cdn.xitu.io/2019/5/24/16ae7d645d00c39b?w=364&amp;h=800&amp;f=png&amp;s=81489" alt=""><br>æˆ‘è¿™é‡Œåªå±•å¼€äº†ä¸€äº›é‡è¦çš„éƒ¨åˆ†ï¼Œä¸€äº›ç½‘ç»œè¯·æ±‚ã€è‡ªå®šä¹‰viewç›¸å…³çš„å°±ä¸æ¶‰åŠã€‚  </p>
<h3 id="1-Contractå±‚"><a href="#1-Contractå±‚" class="headerlink" title="1. Contractå±‚"></a>1. Contractå±‚</h3><p>æˆ‘è§‰å¾—é¦–å…ˆåº”è¯¥ç¼–å†™çš„æ˜¯è¿™ä¸€å±‚ï¼Œå®ƒç”¨æ¥è§„èŒƒæˆ‘ä»¬Viewå’ŒModelçš„å…·ä½“è¡Œä¸ºï¼š<br><strong>DetailMusicContract:</strong><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailMusicContract</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">DetailView</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">showDetailMusic</span><span class="params">(name:<span class="type">String</span>,author:<span class="type">String</span>,imageUrl:<span class="type">String</span>)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">showLyric</span><span class="params">(viewList:<span class="type">ArrayList</span>&lt;<span class="type">View</span>&gt;)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">showToast</span><span class="params">(message:<span class="type">String</span>)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">changeLyricPosition</span><span class="params">(position:<span class="type">Int</span>)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">changeNowTimeTextView</span><span class="params">(time:<span class="type">String</span>)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">changeSeekBarPosition</span><span class="params">(position:<span class="type">Int</span>)</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">DetailModel</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getNowMusic</span><span class="params">(callBack: <span class="type">GetNowMusicCallBack</span>)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getLyric</span><span class="params">(context:<span class="type">Context</span>,callBack: <span class="type">GetLyricCallBack</span>)</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">GetNowMusicCallBack</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">onSuccess</span><span class="params">(music: <span class="type">MyMusic</span>)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">onFail</span><span class="params">(info:<span class="type">String</span>)</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">GetLyricCallBack</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">onSuccess</span><span class="params">(viewList: <span class="type">ArrayList</span>&lt;<span class="type">View</span>&gt;)</span></span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">onFail</span><span class="params">(info:<span class="type">String</span>)</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨<code>interface DetailView</code>ä¸­å®šä¹‰äº†6ä¸ªæ–¹æ³•</p>
<ul>
<li><code>showDetailMuisc</code>ç”¨æ¥æ˜¾ç¤ºå½“å‰æ­Œæ›²çš„åå­—ï¼Œä½œè€…ï¼Œä»¥åŠå›¾ç‰‡</li>
<li><code>showLyric</code>ç”¨æ¥æ˜¾ç¤ºæ­Œè¯(åˆå§‹åŒ–ViewPagerå’ŒAdapter)</li>
<li><code>changeLyricPosition</code>ç”¨æ¥æ›´æ”¹å½“å‰æ­Œè¯çš„ä½ç½®(å³å®ç°æ­Œè¯è½®æ’­)</li>
<li><code>changNowTimeTextView</code>ç”¨æ¥æ›´æ”¹å½“å‰æ­Œæ›²çš„æ’­æ”¾æ—¶é—´</li>
<li><code>changeSeekBarPosition</code>ç”¨æ¥æ›´å˜æ»‘åŠ¨æ¡çš„è¿›åº¦  </li>
</ul>
<p>åœ¨<code>interface DetailModel</code>ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•</p>
<ul>
<li><code>getNowMusic</code>ç”¨äºä»ç®¡ç†éŸ³ä¹æ’­æ”¾çš„Service(æœåŠ¡)ä¸­è·å–å½“å‰æ’­æ”¾çš„éŸ³ä¹</li>
<li><code>getLyric</code>ç”¨äºè·å¾—å½“å‰æ’­æ”¾çš„æ”¾éŸ³ä¹çš„æ­Œè¯</li>
</ul>
<blockquote>
<p>Tipsï¼šå¾ˆå¤šæƒ…å†µä¸‹ï¼ŒModelçš„æ–¹æ³•æ˜¯åé¢æ‰åŠ çš„ï¼Œä»¥ä¸ºä½ å¯èƒ½ä¸€å¼€å§‹ä¸çŸ¥é“Modeléœ€è¦å“ªäº›æ–¹æ³•</p>
</blockquote>
<h3 id="2-Viewå±‚"><a href="#2-Viewå±‚" class="headerlink" title="2. Viewå±‚"></a>2. Viewå±‚</h3><p><strong>BaseActivity</strong>ä¹‹å‰å·²ç»å±•ç¤ºè¿‡ï¼Œå®é™…ä¸Šçš„BaseActivityä¼šå¢åŠ ä¸€äº›å…³äºæœåŠ¡ç»‘å®šçš„ä¸œè¥¿ï¼Œä¸åœ¨æœ¬ç¯‡èŒƒç•´ä¹‹å†…<br><strong>DetailMusicActivity:</strong><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailMusicActivity</span> : <span class="type">BaseActivity</span>&lt;<span class="type">DetailMusicContract.DetailView,</span></span></span><br><span class="line"><span class="class"><span class="type">        DetailMusicPresenter</span>&gt;</span>(),</span><br><span class="line">        DetailMusicContract.DetailView,</span><br><span class="line">        MyMusicPlayerManager.OnStartPlay,</span><br><span class="line">        MyMusicPlayerManager.StartNextMusic,</span><br><span class="line">        View.OnClickListener&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        setContentView(R.layout.activity_detail)</span><br><span class="line">        iv_detail_play.setOnClickListener(<span class="keyword">this</span>)</span><br><span class="line">        iv_detail_previous.setOnClickListener(<span class="keyword">this</span>)</span><br><span class="line">        iv_detail_next.setOnClickListener(<span class="keyword">this</span>)</span><br><span class="line">        iv_detail_back.setOnClickListener(<span class="keyword">this</span>)</span><br><span class="line">        <span class="comment">//éŸ³ä¹å‡†å¤‡å®Œæ¯•çš„å›è°ƒ</span></span><br><span class="line">        MyMusicPlayerManager.instance.setOnStartPlay(<span class="keyword">this</span>)</span><br><span class="line">        MyMusicPlayerManager.instance.setStartNextMusic(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®ç°ç»‘å®šæˆåŠŸåçš„éŸ³ä¹æ•°æ®</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onService</span><span class="params">(name: <span class="type">ComponentName</span>?, service: <span class="type">IBinder</span>?)</span></span> &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>,<span class="string">"ç»‘å®šæˆåŠŸ"</span>,Toast.LENGTH_SHORT).show()</span><br><span class="line">        changeNowMusic()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createPresenter</span><span class="params">()</span></span>: DetailMusicPresenter &#123;</span><br><span class="line">        <span class="keyword">return</span> DetailMusicPresenter()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">showDetailMusic</span><span class="params">(name: <span class="type">String</span>, author: <span class="type">String</span>, imageUrl: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        tv_detail_name.text = name</span><br><span class="line">        tv_detail_author.text = author</span><br><span class="line">        ImageLoader.with(<span class="keyword">this</span>)</span><br><span class="line">                .from(imageUrl)</span><br><span class="line">                .disposeWith(CutToCircle())</span><br><span class="line">                .cacheWith(DoubleCacheUtils.getInstance())</span><br><span class="line">                .into(iv_detail_music)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ”¹å˜éŸ³ä¹çš„æ—¶å€™å¿…è¦æ“ä½œï¼Œæ³¨æ„ï¼Œè¿™é‡Œå¯ä»¥è¿›è¡Œä¸€äº›æ­Œè¯è¿˜æ²¡æœ‰è·å–ä½†æ˜¯å·²ç»å¯ä»¥è¿›è¡Œçš„æ“ä½œ</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">changeNowMusic</span><span class="params">()</span></span> &#123;</span><br><span class="line">        Log.d(<span class="string">"åˆ·æ–°éŸ³ä¹"</span>,<span class="string">""</span>)</span><br><span class="line">        mPresenter.getNowMusic()</span><br><span class="line">        mPresenter.getLyric(<span class="keyword">this</span>)</span><br><span class="line">        mPresenter.startToChangeTextView()</span><br><span class="line">        mPresenter.startToChangeSeekBar()</span><br><span class="line">        sb_detail.max = MyMusicPlayerManager.instance.musicDuration()</span><br><span class="line">        sb_detail.setOnSeekBarChangeListener(<span class="keyword">object</span> : SeekBar.OnSeekBarChangeListener&#123;</span><br><span class="line">            <span class="keyword">var</span> isTouch = <span class="literal">false</span></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onProgressChanged</span><span class="params">(seekBar: <span class="type">SeekBar</span>?, progress: <span class="type">Int</span>, fromUser: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (isTouch)&#123;</span><br><span class="line">                    <span class="keyword">val</span> position = seekBar!!.progress</span><br><span class="line">                    MyMusicPlayerManager.instance.musicSeekTo(position)</span><br><span class="line">                    mPresenter.pause()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStartTrackingTouch</span><span class="params">(seekBar: <span class="type">SeekBar</span>?)</span></span> &#123;</span><br><span class="line">                isTouch = <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onStopTrackingTouch</span><span class="params">(seekBar: <span class="type">SeekBar</span>?)</span></span> &#123;</span><br><span class="line">                isTouch = <span class="literal">false</span></span><br><span class="line">                MyMusicPlayerManager.instance.play()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//è§¦å‘æ˜¾ç¤ºæ­Œè¯çš„å›è°ƒï¼Œæ³¨æ„ï¼Œè¿™é‡Œåº”è¯¥æ”¾åªæœ‰è·å–åˆ°äº†æ­Œè¯ä¹‹åæ‰å¯ä»¥åšå‡ºçš„uiæ“ä½œ</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">showLyric</span><span class="params">(viewList:<span class="type">ArrayList</span>&lt;<span class="type">View</span>&gt;)</span></span> &#123;</span><br><span class="line">        Log.d(<span class="string">"æ­Œè¯æ˜¾ç¤ºå›è°ƒ"</span>,<span class="string">"æˆåŠŸ"</span>)</span><br><span class="line">        runOnUiThread &#123;</span><br><span class="line">            <span class="keyword">val</span> adapter = MyViewPagerAdapter(viewList)</span><br><span class="line">            mb_lyric.<span class="keyword">init</span>()</span><br><span class="line">            mb_lyric.setScrollTime(<span class="number">1500</span>)</span><br><span class="line">            mb_lyric.setAdapter(adapter,<span class="keyword">this</span>)</span><br><span class="line">            mb_lyric.setTransformer(CustomTransformer())</span><br><span class="line">            mPresenter.startToChangeLyric()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onNextMusic</span><span class="params">()</span></span> &#123;</span><br><span class="line">        mPresenter.playNext()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">showToast</span><span class="params">(message:<span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        Toast.makeText(<span class="keyword">this</span>,message,Toast.LENGTH_SHORT).show()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">changeLyricPosition</span><span class="params">(position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        runOnUiThread &#123;</span><br><span class="line">            mb_lyric.changeTo(position)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">changeNowTimeTextView</span><span class="params">(time: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        runOnUiThread&#123;</span><br><span class="line">            tv_detail_now.text = time</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">changeSeekBarPosition</span><span class="params">(position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">        runOnUiThread &#123;</span><br><span class="line">            sb_detail.progress = position</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç‚¹å‡»äº‹ä»¶çš„é›†ä¸­å¤„ç†</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onClick</span><span class="params">(v: <span class="type">View</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">when</span>&#123;</span><br><span class="line">            v!!.id == iv_detail_play.id -&gt; &#123;</span><br><span class="line">                <span class="keyword">if</span> (MyMusicPlayerManager.instance.isPlaying())&#123;</span><br><span class="line">                    mPresenter.pause()</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    mPresenter.play()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            v.id == iv_detail_previous.id -&gt; &#123;</span><br><span class="line">                mPresenter.playPrevious()</span><br><span class="line">            &#125;</span><br><span class="line">            v.id == iv_detail_next.id -&gt; &#123;</span><br><span class="line">                mPresenter.playNext()</span><br><span class="line">            &#125;</span><br><span class="line">            v.id == iv_detail_back.id -&gt; &#123;</span><br><span class="line">                <span class="keyword">this</span>.finish()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿå‘½å‘¨æœŸç›¸å…³</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        mPresenter.cancelTimer()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>çœ‹èµ·æ¥ä»£ç å¯èƒ½æœ‰ç‚¹é•¿ï¼ŒåŸå› æ˜¯è¿™ä¸ªé¡µé¢ç›¸å¯¹æ¥è¯´æœ‰ç‚¹å¤æ‚ï¼Œä½†æ˜¯æ•´ä¸ªViewçš„ç»“æ„å¾ˆæ¸…æ™°ã€‚</p>
<ul>
<li><strong><code>override fun initView</code></strong><br>è¿™ä¸ªæ˜¯ç»§æ‰¿è‡ªBaseActivityé‡Œçš„æ–¹æ³•ï¼Œç”¨äºé¦–æ¬¡å¯åŠ¨åçš„åˆå§‹åŒ–å¸ƒå±€ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åœ¨è¿™é‡Œè®¾ç½®äº†ä¸€äº›æ§ä»¶çš„ç›‘å¬ä»¥åŠå›è°ƒæ¥å£ã€‚éœ€è¦è§£é‡Šçš„æ˜¯<code>MyMusicPlayerManager.instance.setOnStartPlay(this)
MyMusicPlayerManager.instance.setStartNextMusic(this)</code><br>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç”±äºéŸ³ä¹æ’­æ”¾å™¨éœ€è¦ä»ç½‘ç»œä¸Šå¼‚æ­¥åŠ è½½éŸ³ä¹æ’­æ”¾æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸ª<strong>éŸ³ä¹å‡†å¤‡æ’­æ”¾çš„å›è°ƒæ¥å£</strong>ä»¥åŠ<strong>æ’­æ”¾å®Œæ¯•ååˆ‡æ¢åˆ°ä¸‹ä¸€é¦–çš„å›è°ƒæ¥å£</strong>ä»–ä»¬å¯¹åº”çš„æ–¹æ³•ä¸º<br><code>override fun changeNowMusic()</code>å½“å‰çš„éŸ³ä¹å‘ç”Ÿæ”¹å˜æ—¶(ä¸Šä¸€é¦–ä¸‹ä¸€é¦–)çš„è§¦å‘çš„å›è°ƒ<br><code>override fun onNextMusic()</code>å½“æ’­æ”¾å®Œæ¯•ååˆ‡æ¢åˆ°ä¸‹ä¸€é¦–çš„å›è°ƒæ¥å£</li>
<li><strong><code>override fun onService</code></strong><br>è¿™ä¸ªæ˜¯ç»§æ‰¿è‡ªBaseActivityé‡Œçš„æ–¹æ³•(ä¸Šæ–‡ä¸­çš„BaseActivityå¹¶æ²¡æœ‰åŠ å…¥ï¼Œä½†æ˜¯å› ä¸ºè¿™ä¸ªæ˜¯ä¸€ä¸ªéŸ³ä¹Appï¼Œæ‰€ä»¥éœ€è¦å’Œå½“å‰Activityè¿›è¡Œç»‘å®š)åœ¨è¿™é‡Œæˆ‘ä»¬è¿›è¡Œçš„æ˜¯ç»‘å®šæ“ä½œå®Œæ¯•åçš„æ“ä½œ:æ‰§è¡Œ<code>changeNowMusic()</code>æ¥è¿›è¡ŒéŸ³ä¹ç•Œé¢çš„åˆå§‹åŒ–æ“ä½œ</li>
<li><strong><code>override fun createPresenter</code></strong><br>ç»§æ‰¿è‡ªBaseActivityçš„æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Presenterå®ä¾‹</li>
<li><strong><code>override fun showDetailMusic</code></strong><br>è¿™ä¸ªæ˜¯åœ¨Contractæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨äºæ˜¾ç¤ºä¸€äº›æ§ä»¶çš„å€¼</li>
<li><strong><code>override fun changeNowMusic</code></strong><br>åœ¨<code>MyMusicPlayerManager.OnStartPlay</code>æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå…·ä½“å†…å®¹ä¸ºæ˜¾ç¤ºå½“å‰æ­£åœ¨æ’­æ”¾çš„æ­Œæ›²çš„æ‰€æœ‰ä¿¡æ¯ï¼Œé‡Œé¢å‘Presenterå‘é€äº†å››ä¸ªæ¶ˆæ¯ï¼Œ<code>getNowMusic</code>ç”¨äºè¯·æ±‚æ˜¾ç¤ºå½“å‰çš„éŸ³ä¹ã€<code>getLyric</code>ç”¨äºè¯·æ±‚æ­Œè¯ã€<code>startToChangeTextView</code>ç”¨äºè¯·æ±‚å¼€å§‹ä¸æ–­æ›´æ–°å½“å‰æ’­æ”¾æ—¶é—´ã€<code>startToChangeSeekBar</code>ç”¨äºè¯·æ±‚å¼€å§‹ä¸æ–­æ›´æ–°SeekBarçš„è¿›åº¦ã€‚ä¹‹åå°±æ˜¯è®¾ç½®ä¸€äº›SeekBarçš„ç›‘å¬æ¥å®ç°å¯¹éŸ³ä¹è¿›åº¦çš„æ§åˆ¶</li>
<li><strong><code>override fun showLyric</code></strong><br>è¿™ä¸ªæ˜¯åœ¨Contractæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œç”¨æ¥æ˜¾ç¤ºæ­Œè¯ï¼Œåœ¨æœ€åçš„æ—¶å€™è¿˜æƒ³Presenterå‘é€äº†è¯·æ±‚å¼€å§‹æ»šåŠ¨æ­Œè¯ç•Œé¢çš„æ¶ˆæ¯</li>
<li><strong><code>override fun onNextMusic</code></strong><br>è¿™ä¸ªæ˜¯å®šä¹‰åœ¨<code>MyMusicPlayerManager.StartNextMusic</code>æ¥å£ä¸­çš„æ–¹æ³•ï¼Œä¸Šæ–‡å·²ç»æåŠï¼Œåœ¨éŸ³ä¹è‡ªåŠ¨æ’­æ”¾å®Œåå‡ºå‘çš„å›è°ƒï¼Œå³æ’­æ”¾ä¸‹ä¸€é¦–æ­Œ<br>æ¥ä¸‹æ¥çš„ä¸€äº›æ–¹æ³•å°±ä¸ç”¨å¤šè¯´äº†,showToastã€changeLyricPositionã€changeNowTimeTextViewã€changeSeekBarPositionã€è¿˜æœ‰é›†ä¸­å¤„ç†çš„onClickæ§ä»¶ç‚¹å‡»ç›‘å¬  </li>
</ul>
<p><strong>Viewå±‚æ€»ç»“</strong><br>è¯´äº†è¿™ä¹ˆå¤šï¼Œå®é™…ä¸ŠViewå±‚çš„ä½œç”¨ç®€è€Œè¨€ä¹‹å°±æ˜¯ <strong>è¾“å…¥ è¾“å‡º</strong><br><strong>æ ¹æ®ç”¨æˆ·çš„æ“ä½œå‘Presenterå‘é€è¯·æ±‚ã€æä¾›å„å¼å„æ ·çš„æ¥å£æ¥ç»™Presenterå’ŒéŸ³ä¹æœåŠ¡è¿›è¡Œå›è°ƒ</strong></p>
<h3 id="3-Presenterå±‚"><a href="#3-Presenterå±‚" class="headerlink" title="3. Presenterå±‚"></a>3. Presenterå±‚</h3><p><strong>DetailMusicPresenter:</strong><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailMusicPresenter</span> : <span class="type">BasePresenter</span>&lt;<span class="type">DetailMusicContract.DetailView</span>&gt;</span>()&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> lyricTimer:Timer = Timer()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> textViewTimer:Timer = Timer()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> seekBarTimer:Timer = Timer()</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> detailMusicModel = DetailMusicModel()</span><br><span class="line">    <span class="comment">//è·å–ç›®å‰æ’­æ”¾çš„éŸ³ä¹çš„å›è°ƒ</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getNowMusic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        detailMusicModel.getNowMusic(<span class="keyword">object</span> :DetailMusicContract.GetNowMusicCallBack&#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSuccess</span><span class="params">(music: <span class="type">MyMusic</span>)</span></span> &#123;</span><br><span class="line">                mViewRef.<span class="keyword">get</span>()!!.showDetailMusic(music.name,music.author,music.imageUrl)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFail</span><span class="params">(info: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">                mViewRef.<span class="keyword">get</span>()!!.showToast(info)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getLyric</span><span class="params">(context: <span class="type">Context</span>)</span></span>&#123;</span><br><span class="line">        detailMusicModel.getLyric(context,<span class="keyword">object</span> :DetailMusicContract.GetLyricCallBack&#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSuccess</span><span class="params">(viewList:<span class="type">ArrayList</span>&lt;<span class="type">View</span>&gt;)</span></span> &#123;</span><br><span class="line">                mViewRef.<span class="keyword">get</span>()!!.showLyric(viewList)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFail</span><span class="params">(info: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">                mViewRef.<span class="keyword">get</span>()!!.showToast(info)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startToChangeLyric</span><span class="params">()</span></span>&#123;</span><br><span class="line">        lyricTimer = Timer()</span><br><span class="line">        lyricTimer.schedule(<span class="keyword">object</span> : TimerTask() &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">                mViewRef.<span class="keyword">get</span>()!!.changeLyricPosition(MyMusicPlayerManager.instance.getNowLyricPosition())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ,<span class="number">0</span>,<span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startToChangeTextView</span><span class="params">()</span></span>&#123;</span><br><span class="line">        textViewTimer = Timer()</span><br><span class="line">        textViewTimer.schedule(<span class="keyword">object</span> : TimerTask()&#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">                mViewRef.<span class="keyword">get</span>()!!.changeNowTimeTextView(MyMusicPlayerManager.instance.nowTimeInMin())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">0</span>,<span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">startToChangeSeekBar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        seekBarTimer = Timer()</span><br><span class="line">        seekBarTimer.schedule(<span class="keyword">object</span> :TimerTask()&#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">                mViewRef.<span class="keyword">get</span>()!!.changeSeekBarPosition(MyMusicPlayerManager.instance.musicCurrent())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,<span class="number">0</span>,<span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//éŸ³ä¹æ§åˆ¶</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">play</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MyMusicPlayerManager.instance.play()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">pause</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MyMusicPlayerManager.instance.pause()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">playPrevious</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cancelTimer()</span><br><span class="line">        MyMusicPlayerManager.instance.playPrevious()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">playNext</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cancelTimer()</span><br><span class="line">        MyMusicPlayerManager.instance.playNext()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">cancelTimer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        lyricTimer.cancel()</span><br><span class="line">        textViewTimer.cancel()</span><br><span class="line">        seekBarTimer.cancel()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å› ä¸ºPresenterçš„åŠŸèƒ½å°±æ˜¯è½¬å‘ï¼Œæ‰€ä»¥ä»£ç ä¸é•¿ï¼Œè€Œä¸”ç»“æ„æ¸…æ™°</p>
<ul>
<li>é¦–å…ˆæ‹¥æœ‰ä¸€ä¸ªDetailModelå®ä¾‹ï¼Œä¸éœ€è¦å¤ªå¤šé˜è¿°</li>
<li><code>getNowMusic</code><br>è¿™ä¸ªæ˜¯åœ¨Viewå±‚ä¸­è°ƒç”¨çš„ï¼Œç”¨æ¥è·å¾—å½“å‰éŸ³ä¹çš„ä¿¡æ¯ï¼Œä»£ç å¹¶ä¸éš¾ç†è§£ï¼Œå‘Modelè¯·æ±‚è·å¾—å½“å‰çš„éŸ³ä¹ï¼ŒæˆåŠŸçš„è¯å°±é€šè¿‡Presenteræ‹¥æœ‰çš„Viewå±‚çš„å¼•ç”¨æ¥è°ƒç”¨ä¹‹å‰å·²ç»åœ¨Contractä¸­å®šä¹‰å¥½çš„<code>showDetailMusic</code>æ–¹æ³•æ¥é€šçŸ¥Viewå±‚æ›´æ–°ï¼Œå¦‚æœå¤±è´¥é‚£å°±è°ƒç”¨ä¹‹å‰ä¹Ÿåœ¨Contractä¸­å®šä¹‰å¥½çš„<code>showToast</code>æ–¹æ³•æ¥æ˜¾ç¤ºToastä¿¡æ¯æé†’ç”¨æˆ·</li>
<li><code>fun getLyric</code><br>è¿™ä¸ªæ˜¯ä¹Ÿæ˜¯åœ¨Viewå±‚ä¸­è°ƒç”¨çš„ï¼Œç”¨æ¥è·å–å½“å‰éŸ³ä¹çš„æ­Œè¯ï¼ŒæˆåŠŸåˆ™å›è°ƒViewå±‚çš„æ¥å£æ¥æ˜¾ç¤ºæ­Œè¯ï¼Œå¦åˆ™æ˜¾ç¤ºToast</li>
<li><code>fun startToChangeLyric</code> ã€<code>fun startToChangeTextView</code>ã€<code>fun startToChangeSeekBar</code><br>åŒæ ·æ˜¯åœ¨Viewå±‚ä¸­å®šä¹‰çš„ï¼Œå®ç°æ–¹å¼å‡ ä¹ä¸€è‡´ï¼Œå¼€å¯ä¸€ä¸ªæ–°çš„TimerTaskï¼Œå®šæ—¶è·å–å½“å‰æ­Œè¯åº”è¯¥åœ¨çš„positionã€å½“å‰å·²ç»æ’­æ”¾æ—¶é—´ã€å½“å‰SeekBaråº”è¯¥åœ¨çš„è¿›åº¦ï¼Œç„¶åå›è°ƒViewå±‚å¯¹åº”çš„æ–¹æ³•æ¥æ›´æ–°</li>
<li>éŸ³ä¹æ§åˆ¶ä¸å¿…å¤šè¯´ï¼Œä¸è¿‡æ³¨æ„ä¸Šä¸€é¦–ä¸‹ä¸€é¦–æ—¶éœ€è¦å…ˆå–æ¶ˆTimerï¼Œå¦åˆ™ä¼šå‡ºç°æŠ¥é”™</li>
<li><code>fun cancelTimer</code><br>ç”¨æ¥å–æ¶ˆTimerï¼Œå½“æ¢æ­Œã€Viewé”€æ¯æ—¶ï¼Œç”±äºTimeråœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œä¼šå¯¼è‡´Lyricæ²¡æœ‰åˆå§‹åŒ–ï¼Œæˆ–è€…nullPointæŠ¥é”™</li>
</ul>
<h3 id="4-Modelå±‚"><a href="#4-Modelå±‚" class="headerlink" title="4. Modelå±‚"></a>4. Modelå±‚</h3><p><strong>DetailMusic:</strong><br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailMusicModel</span>: <span class="type">DetailMusicContract.DetailModel &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getNowMusic</span><span class="params">(callBack: <span class="type">DetailMusicContract</span>.<span class="type">GetNowMusicCallBack</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">val</span> music = MyMusicPlayerManager.instance.nowMusic()</span><br><span class="line">        callBack.onSuccess(music)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getLyric</span><span class="params">(context:<span class="type">Context</span>,callBack: <span class="type">DetailMusicContract</span>.<span class="type">GetLyricCallBack</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> music = MyMusicPlayerManager.instance.nowMusic()</span><br><span class="line">        <span class="keyword">val</span> request = Request.Builder(<span class="string">"http://elf.egos.hosigus.com/music/lyric?id=<span class="subst">$&#123;music.id&#125;</span>"</span>)</span><br><span class="line">                .setMethod(<span class="string">"GET"</span>).build()</span><br><span class="line">        NetUtil.getInstance().execute(request,<span class="keyword">object</span> :Callback&#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onResponse</span><span class="params">(response: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">                <span class="keyword">val</span> mainJson = JSONObject(response)</span><br><span class="line">                <span class="keyword">val</span> str = mainJson.getJSONObject(<span class="string">"lrc"</span>).getString(<span class="string">"lyric"</span>)</span><br><span class="line">                <span class="keyword">val</span> lyric = Lyric(str!!)</span><br><span class="line">                MyMusicPlayerManager.instance.nowMusic().lyric = lyric</span><br><span class="line">                <span class="keyword">val</span> viewList = ArrayList&lt;View&gt;()</span><br><span class="line">                <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until lyric.arrayList.size)&#123;</span><br><span class="line">                    <span class="keyword">val</span> view = LayoutInflater.from(context).inflate(R.layout.item_lyric,<span class="literal">null</span>)</span><br><span class="line">                    view.findViewById&lt;TextView&gt;(R.id.tv_item_lyric).text=lyric.arrayList[i]</span><br><span class="line">                    viewList.add(view)</span><br><span class="line">                &#125;</span><br><span class="line">                callBack.onSuccess(viewList)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onFailed</span><span class="params">(t: <span class="type">Throwable</span>?)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Modelç±»ä¸»è¦ç”¨æ¥æ”¶é›†æ•°æ®å¹¶æä¾›ç»™Presenter</p>
<ul>
<li><code>override fun getNowMusic</code><br>è·å–å½“å‰çš„éŸ³ä¹å¹¶å›è°ƒåˆ°Presenter,è€ŒPresenteræ”¶åˆ°å›è°ƒåä¼šé€šçŸ¥Viewå±‚è¿›è¡Œæ›´æ–°</li>
<li><code>override fun getLyric</code><br>è·å–å½“å‰çš„æ­Œè¯å¹¶æ‰“åŒ…æˆArrayList<view>å›è°ƒç»™Presenterï¼Œè€ŒPresenteræ”¶åˆ°å›è°ƒåä¼šé€šçŸ¥ç»™Viewå±‚è¿›è¡Œæ›´æ–°</view></li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡åªé’ˆå¯¹MVPçš„ç»“æ„è¿›è¡Œäº†åˆ†æï¼Œä¸€äº›å…¶ä»–çš„å†…å®¹ï¼Œå¦‚éŸ³ä¹æ’­æ”¾å™¨ï¼Œè‡ªå®šä¹‰æ­Œè¯Viewç­‰å¹¶æ²¡æœ‰æ¶‰åŠï¼Œå¦‚æœæ„Ÿå…´è¶£çš„è¯å¯ä»¥è®¿é—®<a href="https://github.com/Override0330/MRedrockExam2019" target="_blank" rel="noopener">GitHubæºç åœ°å€</a>  </p>
<h2 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h2><p>æŠ±æ­‰æ‹‰ä½äº†æ˜é‡‘çš„æ–‡ç« è´¨é‡ã€‚ã€‚ã€‚<br>æœ¬äººæŠ€æœ¯æœ‰é™,ä»ç„¶åœ¨å­¦ä¹ å½“ä¸­ï¼Œå¦‚æœæœ‰ä»€ä¹ˆä¸å¯¹çš„åœ°æ–¹å¸Œæœ›å¤§ä½¬ä»¬æŒ‡æ­£ï¼ï¼ï¼<br>å†™çš„åˆè¡·ä¹Ÿåªæ˜¯æ¥æ€»ç»“ç½¢äº†ï¼Œå¹¶æ²¡æœ‰æƒ³è¿‡ä¼šæœ‰å¤šå°‘äººçœ‹hhhhhhğŸ¤£</p>

        </section>
    </article>
    
        
  </div>
  <aside>
    
    <div class="toc-container">
        <h1>ç›®å½•</h1>
        <div class="content">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-What-is-thatï¼Ÿ"><span class="toc-number">1.</span> <span class="toc-text">1. What is thatï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-MVPé€šç”¨æ¡†æ¶"><span class="toc-number">2.</span> <span class="toc-text">2. MVPé€šç”¨æ¡†æ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Contractå±‚"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Contractå±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-Modelå±‚"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Modelå±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Viewå±‚"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Viewå±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-Presenterå±‚"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 Presenterå±‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-å®æˆ˜"><span class="toc-number">3.</span> <span class="toc-text">3. å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Contractå±‚"><span class="toc-number">3.1.</span> <span class="toc-text">1. Contractå±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Viewå±‚"><span class="toc-number">3.2.</span> <span class="toc-text">2. Viewå±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Presenterå±‚"><span class="toc-number">3.3.</span> <span class="toc-text">3. Presenterå±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Modelå±‚"><span class="toc-number">3.4.</span> <span class="toc-text">4. Modelå±‚</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">4.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Other"><span class="toc-number">5.</span> <span class="toc-text">Other</span></a></li></ol>
        </div>
    </div>
    
  </aside>
</main>



  <footer>
  <div class="copyright">
    <div>
      &copy; 2019 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a>&nbsp
    </div>
    <div>
      Theme by <a href="https://github.com/lewis-geek/hexo-theme-Aath" target="_blank">Aath</a>
    </div>
  </div>
</footer>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="/lib/in-view.min.js"></script>
<script src="/lib/lodash.min.js"></script>
<script>
  var isDown = true
  var oldY = 0
  inView.offset(50)

  document.body.addEventListener('touchstart', function(){});
  
  window.addEventListener('scroll', _.throttle(e => {
    var currentY = window.scrollY
    if((oldY - currentY) < 0) {
      isDown = true
    } else {
      isDown = false
    }
    oldY = currentY
  }, 250))

  $("article img").each(function() {
      var strA = "<a data-fancybox='gallery' href='" + this.src + "'></a>";
      $(this).wrapAll(strA);
  });

  $('.toc-link').each(function() {
      var href = $(this).attr("href");
      
      inView(href).on('exit', () => {
        if (isDown) {
          handleActive(href)
        }
      })

      inView(href).on('enter', () => {
        if (!isDown) {
          handleActive(href)
        }
      })

      this.onclick = function(e) {
        var pos = $(href).offset().top - 10;
        $("html,body").animate({scrollTop: pos}, 300);
        setTimeout(() => {
          handleActive(href)
        }, 350)
        return false
      }
  })

  function handleActive(href) {
    document.querySelectorAll('.toc-link').forEach(elm => {
      elm.classList.remove('active')
    })
    document.querySelector(".toc [href='"+ href +"']").classList.add('active')
  }
</script>
<script src="/lib/jquery.fancybox.min.js"></script>


</body>
</html>
